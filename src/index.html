<!DOCTYPE html>
<html lang="en">
<head>
    <title>My Hikes </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/favicon.ico" sizes="any">
    <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
</head>
<body>
    <div id="map"></div>

    <div class="menu">
        <label class="hamburger_menu" for="hamburgerCheck">üçî
        </label>
            <input type="checkbox" id="hamburgerCheck">
            <ul class="menuList">
                <li>Layer:<select id="selectLayer">
                    <option value="swisstopo">Swiss Topo</option>
                    <option value="openstreetmap">Street Map</option>
                    </select>
               
                <li><input type="checkbox" id="chkShowRecordButton" name="chkShowRecordButton"><label for="chkShowRecordButton">
                    Record map sections for (later) offline use</label></li>
                    <label for="fileInput">
                        Select GPX file to display on map:</label>
                <li><input multiple type="file" id="fileInput" name="fileInput"></li>
                    <li><button id="btnSampleRoutes" title="Sabrina's most prefered hikes">Load sample routes</button></li>
                    <li><button id="btnReset" title="Delete Cache, kick Service-Worker, remove saved routes.">Reset Application</button></li>
        </ul>
    </label>
    </div>
    <input type="checkbox" id="recButton" class="recordingButton">
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
<script src="gpx.js"></script>
<script src="https://unpkg.com/togeojson@0.14.2"></script>
<script src="leaflet.filelayer.js"></script>
<script type="module" src="index.js"></script>
<script type="module">

import {initMap,addToMap} from './index.js';
import {loadSampleRoutes,checkForNewSampleRoute} from './modules/sampleRoutes.js';
import {initRecordMapLayer} from  './modules/recordMapLayer.js'
import {resetApplication} from  './modules/applicationReset.js'
import {installServiceWorker} from  './modules/serviceWorkerRegister.js'
import {initMapLayer,layerChanged} from  './modules/mapLayer.js'
import {initFileDroppedChannel,loadTracksFromLocalStorage,processFile } from "./modules/localStorageTracks.js";

window.addEventListener("load", function () {
  var map = initMap();
  initMapLayer(map);
  loadTracksFromLocalStorage(addToMap);
  checkForNewSampleRoute(addToMap);
});
installServiceWorker();
initFileDroppedChannel(addToMap);
document.getElementById("btnReset").addEventListener("click", resetApplication, false);
document.getElementById("btnSampleRoutes").addEventListener("click",() => loadSampleRoutes(addToMap), false);
document.getElementById("fileInput").addEventListener("change",(e) => {
    [... e.target.files].forEach((file) =>{
        processFile(file).then(addToMap);
    });
}, false);


initRecordMapLayer();
</script>


</html>
